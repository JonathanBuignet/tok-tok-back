DROP TABLE If EXISTS "User"
DROP TABLE If EXISTS "Likes"
DROP TABLE If EXISTS "Post"
DROP TABLE If EXISTS "Message"
DROP TABLE If EXISTS "Favourites"
DROP TABLE If EXISTS "Advert"
DROP TABLE If EXISTS "Advert_has_image"
DROP TABLE If EXISTS "Tag"

CREATE TABLE user (
  id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  firstname VARCHAR(64) NOT NULL,
  lastname VARCHAR(64) NOT NULL,
  description VARCHAR(255),
  address TEXT NOT NULL,
  localization TEXT NOT NULL,
  email VARCHAR(64) NOT NULL,
  password VARCHAR(64) NOT NULL,
  thumbnail TEXT,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);


CREATE TABLE annonce (
  id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  title VARCHAR(64) NOT NULL,
  content TEXT NOT NULL,
  price SMALLINT NOT NULL,
  user_id INT UNSIGNED NOT NULL,
  tag_id INT UNSIGNED NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES user(id),
  FOREIGN KEY (tag_id) REFERENCES tag(id)
);


CREATE TABLE annonce_image (
  id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  annonce_id INT UNSIGNED NOT NULL,
  thumbnail TEXT NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (annonce_id) REFERENCES annonce(id)
);

CREATE TABLE post (
  id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  content TEXT NOT NULL,
  thumbnail TEXT,
  reply_to INT,
  user_id INT NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES user(id)
);

CREATE TABLE message (
  id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  content TEXT NOT NULL,
  expediteur INT NOT NULL,
  destinataire INT NOT NULL,
  conversation_id INT NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (expediteur) REFERENCES user(id),
  FOREIGN KEY (destinataire) REFERENCES user(id)
);

CREATE TABLE tag (
  id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(64) NOT NULL
);

CREATE TABLE favoris (
  id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  annonce_id INT NOT NULL,
  user_id INT NOT NULL,
  FOREIGN KEY (annonce_id) REFERENCES annonce(id),
  FOREIGN KEY (user_id) REFERENCES user(id)
);

CREATE TABLE likes (
  id INT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
  post_id INT NOT NULL,
  user_id INT NOT NULL,
  FOREIGN KEY (post_id) REFERENCES post(id),
  FOREIGN KEY (user_id) REFERENCES user(id)
);






